<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pathway - Pharmacy POS System</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                    <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none"/>
                </svg>
                Pathway Pharmacy POS
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#dashboard" class="active">Dashboard</a></li>
                    <li><a href="#pos">POS</a></li>
                    <li><a href="#inventory">Inventory</a></li>
                    <li><a href="#expiry">Expiry Alerts</a></li>
                    <li><a href="#customers">Customers</a></li>
                    <li><a href="#sales">Sales</a></li>
                    <li><a href="#reports">Reports</a></li>
                    <li><a href="#settings">Settings</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <span>Welcome, Pharmacist</span>
                <button class="btn btn-secondary btn-sm">Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Comprehensive Dashboard Section -->
        <section id="dashboard-section" style="display: block;">
            <div class="main-container" style="grid-template-columns: 1fr;">
                <!-- Welcome Header -->
                <div class="card dashboard-card" style="margin-bottom: 2rem;">
                    <div class="card-content">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h1 style="margin: 0 0 0.5rem 0; color: var(--text-color);">Welcome to Pathway Pharmacy</h1>
                                <p style="margin: 0; color: var(--dark-gray); font-size: 1.125rem;">Your comprehensive pharmacy management system</p>
                                <p style="margin: 0.5rem 0 0 0; color: var(--dark-gray);">Today is <span id="current-date"></span></p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="current-time"></div>
                                <div style="color: var(--dark-gray);">Current Time</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Performance Indicators -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card stat-success">
                        <div class="stat-value">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                            </svg>
                            ₵8,450.25
                        </div>
                        <div class="stat-label">Monthly Revenue</div>
                        <div class="badge success" style="margin-top: 0.5rem;">+15.2% vs last month</div>
                    </div>

                    <div class="stat-card stat-info">
                        <div class="stat-value">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            156
                        </div>
                        <div class="stat-label">Total Products</div>
                        <div class="badge info" style="margin-top: 0.5rem;">8 categories</div>
                    </div>

                    <div class="stat-card stat-warning">
                        <div class="stat-value">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                            </svg>
                            7
                        </div>
                        <div class="stat-label">Expiry Alerts</div>
                        <div class="badge warning" style="margin-top: 0.5rem;">Needs attention</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-value">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 8H16c-.8 0-1.54.37-2 .95L12.95 10H11l-2.05-1.05C8.54 8.37 7.8 8 7 8H4.46c-.8 0-1.49.59-1.61 1.37L.85 16H3.5v6h9v-6h4z"/>
                            </svg>
                            3
                        </div>
                        <div class="stat-label">Active Customers</div>
                        <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.5rem;">This month</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="feature-grid" style="margin-bottom: 2rem;">
                    <div class="card feature-card" onclick="showSection('pos-section')">
                        <div class="card-content" style="text-align: center;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--primary-color)" style="margin-bottom: 1rem;">
                                <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                            </svg>
                            <h3>Start Sale</h3>
                            <p>Process customer transactions</p>
                        </div>
                    </div>

                    <div class="card feature-card" onclick="showSection('inventory-section')">
                        <div class="card-content" style="text-align: center;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--secondary-color)" style="margin-bottom: 1rem;">
                                <path d="M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zM19 20H5V9h14v11z"/>
                            </svg>
                            <h3>Manage Inventory</h3>
                            <p>Track stock and products</p>
                        </div>
                    </div>

                    <div class="card feature-card" onclick="showSection('expiry-dashboard')">
                        <div class="card-content" style="text-align: center;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--warning-color)" style="margin-bottom: 1rem;">
                                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                            </svg>
                            <h3>Expiry Alerts</h3>
                            <p>Monitor product expiration</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- POS Section -->
        <section id="pos-section" class="pos-section">
            <!-- POS Dashboard Stats -->
            <div class="dashboard-grid" style="margin-bottom: 2rem;">
                <div class="card stats-card">
                    <div class="stat-value" id="pos-daily-sales">₵292.79</div>
                    <div class="stat-label">Today's Sales</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 65%"></div>
                    </div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.5rem;">65% of daily target</div>
                </div>

                <div class="card stats-card">
                    <div class="stat-value" id="pos-transactions">3</div>
                    <div class="stat-label">Transactions</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%"></div>
                    </div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.5rem;">45% of daily target</div>
                </div>

                <div class="card stats-card">
                    <div class="stat-value" id="pos-avg-sale">₵97.60</div>
                    <div class="stat-label">Average Sale</div>
                    <div class="badge success" style="margin-top: 0.5rem;">+12% vs yesterday</div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Product Search</h2>
                </div>
                <div class="card-content">
                    <div class="search-section">
                        <input 
                            type="text" 
                            id="product-search" 
                            class="search-input" 
                            placeholder="Search products by name, SKU, or scan barcode..."
                            autocomplete="off"
                        >
                        <button class="btn btn-primary">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            Search
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Grid -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        Products
                    </h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <select id="category-filter" class="search-input" style="max-width: 150px;">
                            <option value="">All Categories</option>
                            <option value="1">Pain Relief</option>
                            <option value="2">Antibiotics</option>
                            <option value="3">Vitamins</option>
                            <option value="4">Cold & Flu</option>
                            <option value="5">Diabetes</option>
                        </select>
                        <button class="btn btn-secondary" onclick="refreshProducts()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="product-grid" class="product-grid">
                        <!-- Products will be loaded here -->
                        <div style="grid-column: 1 / -1; text-align: center; color: #64748b; padding: 3rem;">
                            <div style="display: inline-block; position: relative;">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" style="margin-bottom: 1rem; opacity: 0.5;">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    <div style="width: 20px; height: 20px; border: 2px solid var(--primary-color); border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                </div>
                            </div>
                            <h3 style="margin: 1rem 0 0.5rem 0; color: var(--text-color);">Loading Products</h3>
                            <p>Please wait while we fetch the latest product information...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cart Section -->
        <aside class="cart-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Shopping Cart</h2>
                    <button id="clear-cart" class="btn btn-secondary btn-sm">Clear Cart</button>
                </div>
                <div class="card-content">
                    <div id="cart-items" class="cart-items">
                        <!-- Cart items will be displayed here -->
                        <div class="empty-cart" style="text-align: center; color: #64748b; padding: 2rem;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="margin-bottom: 1rem;">
                                <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                            </svg>
                            <p>Cart is empty</p>
                            <p style="font-size: 0.875rem;">Add products to start a transaction</p>
                        </div>
                    </div>
                    
                    <div id="cart-summary" class="cart-summary">
                        <!-- Cart summary will be displayed here -->
                    </div>
                    
                    <div class="cart-actions" style="margin-top: 1rem;">
                        <button id="checkout-btn" class="btn btn-success" style="width: 100%;" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            Checkout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card" style="margin-top: 1rem;">
                <div class="card-header">
                    <h3 class="card-title">Quick Actions</h3>
                </div>
                <div class="card-content">
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm" onclick="holdTransaction()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            Hold Transaction
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showCustomerModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            Add Customer
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showDiscountModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Apply Discount
                        </button>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Expiry Alerts Dashboard (Hidden by default) -->
    <section id="expiry-dashboard" style="display: none;">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                        </svg>
                        Expiry Management Dashboard
                    </h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div class="badge danger" style="animation: pulse 2s infinite;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                            </svg>
                            Urgent Action Required
                        </div>
                        <button class="btn btn-primary" onclick="exportExpiryReport()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Export Report
                        </button>
                        <button class="btn btn-secondary" onclick="loadExpiryDashboard()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- Expiry stats grid -->
                    <div class="expiry-grid">
                        <div class="stat-card stat-critical">
                            <div class="stat-value" id="critical-count">0</div>
                            <div class="stat-label">Critical (≤1 week)</div>
                        </div>
                        <div class="stat-card stat-warning">
                            <div class="stat-value" id="high-count">0</div>
                            <div class="stat-label">High Priority (≤1 month)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="medium-count">0</div>
                            <div class="stat-label">Medium (≤3 months)</div>
                        </div>
                        <div class="stat-card stat-success">
                            <div class="stat-value" id="total-value">$0</div>
                            <div class="stat-label">Total Inventory Value</div>
                        </div>
                    </div>

                    <!-- Critical alerts table -->
                    <div style="margin-top: 2rem;">
                        <h3>Critical Expiry Alerts</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Batch</th>
                                    <th>Quantity</th>
                                    <th>Expiry Date</th>
                                    <th>Days Left</th>
                                    <th>Value</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="critical-alerts-table">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #64748b;">
                                        Loading expiry alerts...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Inventory Management Section -->
    <section id="inventory-section" style="display: none;">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <!-- Enhanced Inventory Stats -->
            <div class="dashboard-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-value" id="total-products">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        0
                    </div>
                    <div class="stat-label">Total Products</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                </div>
                <div class="stat-card stat-warning">
                    <div class="stat-value" id="low-stock-count">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                        </svg>
                        0
                    </div>
                    <div class="stat-label">Low Stock Items</div>
                    <div class="badge warning" style="margin-top: 0.5rem;">Needs Attention</div>
                </div>
                <div class="stat-card stat-success">
                    <div class="stat-value" id="inventory-value">₵0</div>
                    <div class="stat-label">Total Inventory Value</div>
                    <div class="badge success" style="margin-top: 0.5rem;">+5.2% this month</div>
                </div>
                <div class="stat-card stat-info">
                    <div class="stat-value" id="categories-count">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"/>
                        </svg>
                        0
                    </div>
                    <div class="stat-label">Categories</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.5rem;">Well organized</div>
                </div>
            </div>

            <!-- Inventory Health Chart -->
            <div class="chart-container" style="margin-bottom: 2rem;">
                <div class="chart-header">
                    <h3 class="chart-title">Inventory Health Overview</h3>
                    <select class="search-input" style="max-width: 120px;">
                        <option>Last 7 days</option>
                        <option>Last 30 days</option>
                        <option>Last 90 days</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="text-align: center; padding: 1rem;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-color);">92%</div>
                        <div style="font-size: 0.875rem; color: #64748b;">In Stock</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92%; background: var(--success-color);"></div>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 1rem;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--warning-color);">6%</div>
                        <div style="font-size: 0.875rem; color: #64748b;">Low Stock</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 6%; background: var(--warning-color);"></div>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 1rem;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--danger-color);">2%</div>
                        <div style="font-size: 0.875rem; color: #64748b;">Out of Stock</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 2%; background: var(--danger-color);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Inventory Management</h2>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            Add Product
                        </button>
                        <button class="btn btn-secondary" onclick="showAddBatchModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Add Stock
                        </button>
                        <button class="btn btn-secondary" onclick="exportInventory()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="search-section" style="margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="text" id="inventory-search" class="search-input" placeholder="Search products..." style="flex: 1; min-width: 200px;">
                        <select id="category-filter" class="search-input" style="max-width: 200px;">
                            <option value="">All Categories</option>
                            <option value="1">Pain Relief</option>
                            <option value="2">Antibiotics</option>
                            <option value="3">Vitamins</option>
                            <option value="4">Cold & Flu</option>
                            <option value="5">Diabetes</option>
                        </select>
                        <select id="stock-filter" class="search-input" style="max-width: 150px;">
                            <option value="">All Stock Levels</option>
                            <option value="low">Low Stock</option>
                            <option value="normal">Normal Stock</option>
                            <option value="high">High Stock</option>
                        </select>
                        <button class="btn btn-secondary" onclick="filterInventory()">Filter</button>
                    </div>

                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>SKU</th>
                                    <th>Category</th>
                                    <th>Current Stock</th>
                                    <th>Min Stock</th>
                                    <th>Cost Price (₵)</th>
                                    <th>Selling Price (₵)</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: #64748b;">
                                        Loading inventory...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Customer Management Section -->
    <section id="customers-section" style="display: none;">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <!-- Enhanced Customer Stats -->
            <div class="dashboard-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-value" id="total-customers">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 8H16c-.8 0-1.54.37-2 .95L12.95 10H11l-2.05-1.05C8.54 8.37 7.8 8 7 8H4.46c-.8 0-1.49.59-1.61 1.37L.85 16H3.5v6h9v-6h4z"/>
                        </svg>
                        0
                    </div>
                    <div class="stat-label">Total Customers</div>
                    <div class="badge info" style="margin-top: 0.5rem;">Growing steadily</div>
                </div>
                <div class="stat-card stat-success">
                    <div class="stat-value" id="active-customers">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        0
                    </div>
                    <div class="stat-label">Active This Month</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 78%"></div>
                    </div>
                </div>
                <div class="stat-card stat-warning">
                    <div class="stat-value" id="loyalty-members">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                        0
                    </div>
                    <div class="stat-label">Loyalty Members</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.5rem;">85% retention rate</div>
                </div>
                <div class="stat-card stat-info">
                    <div class="stat-value" id="avg-spent">₵0</div>
                    <div class="stat-label">Average Spent</div>
                    <div class="badge success" style="margin-top: 0.5rem;">+8% vs last month</div>
                </div>
            </div>

            <!-- Customer Insights -->
            <div class="feature-grid" style="margin-bottom: 2rem;">
                <div class="card feature-card" onclick="showCustomerSegments()">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--primary-color)" style="margin-bottom: 1rem;">
                            <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 8H16c-.8 0-1.54.37-2 .95L12.95 10H11l-2.05-1.05C8.54 8.37 7.8 8 7 8H4.46c-.8 0-1.49.59-1.61 1.37L.85 16H3.5v6h9v-6h4z"/>
                        </svg>
                        <h3>Customer Segments</h3>
                        <p>Analyze customer behavior patterns</p>
                    </div>
                </div>

                <div class="card feature-card" onclick="showLoyaltyProgram()">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--secondary-color)" style="margin-bottom: 1rem;">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                        <h3>Loyalty Program</h3>
                        <p>Manage rewards and points</p>
                    </div>
                </div>

                <div class="card feature-card" onclick="showCustomerAnalytics()">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--info-color)" style="margin-bottom: 1rem;">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <h3>Analytics</h3>
                        <p>Customer purchase insights</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Customer Management</h2>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="showAddCustomerModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z"/>
                            </svg>
                            Add Customer
                        </button>
                        <button class="btn btn-secondary" onclick="importCustomers()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Import
                        </button>
                        <button class="btn btn-secondary" onclick="exportCustomers()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="search-section" style="margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="text" id="customer-search" class="search-input" placeholder="Search customers..." style="flex: 1; min-width: 200px;">
                        <select id="customer-type-filter" class="search-input" style="max-width: 150px;">
                            <option value="">All Customers</option>
                            <option value="loyalty">Loyalty Members</option>
                            <option value="regular">Regular</option>
                            <option value="vip">VIP</option>
                        </select>
                        <button class="btn btn-secondary" onclick="filterCustomers()">Filter</button>
                    </div>

                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Customer ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Address</th>
                                    <th>Loyalty Points</th>
                                    <th>Total Spent (₵)</th>
                                    <th>Last Visit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customers-table">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: #64748b;">
                                        Loading customers...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sales History Section -->
    <section id="sales-section" style="display: none;">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Sales History & Analytics</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="date" id="sales-date-from" class="search-input" style="max-width: 150px;">
                        <input type="date" id="sales-date-to" class="search-input" style="max-width: 150px;">
                        <select id="payment-method-filter" class="search-input" style="max-width: 150px;">
                            <option value="">All Payments</option>
                            <option value="cash">Cash</option>
                            <option value="mobile_money">Mobile Money</option>
                            <option value="card">Card</option>
                            <option value="insurance">Insurance</option>
                        </select>
                        <button class="btn btn-secondary" onclick="filterSales()">Filter</button>
                        <button class="btn btn-primary" onclick="exportSales()">Export Sales</button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- Sales Statistics -->
                    <div class="expiry-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card stat-success">
                            <div class="stat-value" id="today-sales">₵0.00</div>
                            <div class="stat-label">Today's Sales</div>
                            <div class="stat-change" id="today-change">+0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="week-sales">₵0.00</div>
                            <div class="stat-label">This Week</div>
                            <div class="stat-change" id="week-change">+0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="month-sales">₵0.00</div>
                            <div class="stat-label">This Month</div>
                            <div class="stat-change" id="month-change">+0%</div>
                        </div>
                        <div class="stat-card stat-warning">
                            <div class="stat-value" id="total-transactions">0</div>
                            <div class="stat-label">Total Transactions</div>
                            <div class="stat-change" id="transactions-change">+0</div>
                        </div>
                    </div>

                    <!-- Payment Method Breakdown -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Payment Methods Breakdown</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="payment-stat">
                                    <div class="payment-method">Cash</div>
                                    <div class="payment-amount">₵1,250.50</div>
                                    <div class="payment-percentage">45%</div>
                                </div>
                                <div class="payment-stat">
                                    <div class="payment-method">Mobile Money</div>
                                    <div class="payment-amount">₵980.75</div>
                                    <div class="payment-percentage">35%</div>
                                </div>
                                <div class="payment-stat">
                                    <div class="payment-method">Card</div>
                                    <div class="payment-amount">₵420.25</div>
                                    <div class="payment-percentage">15%</div>
                                </div>
                                <div class="payment-stat">
                                    <div class="payment-method">Insurance</div>
                                    <div class="payment-amount">₵140.00</div>
                                    <div class="payment-percentage">5%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sales Table -->
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sale #</th>
                                    <th>Date & Time</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Subtotal (₵)</th>
                                    <th>VAT (₵)</th>
                                    <th>Total (₵)</th>
                                    <th>Payment Method</th>
                                    <th>Cashier</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sales-table">
                                <tr>
                                    <td colspan="11" style="text-align: center; color: #64748b;">
                                        Loading sales...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div style="display: flex; justify-content: between; align-items: center; margin-top: 1rem;">
                        <div>
                            <span>Showing 1-10 of 156 transactions</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary btn-sm" onclick="previousPage()">Previous</button>
                            <button class="btn btn-secondary btn-sm">1</button>
                            <button class="btn btn-primary btn-sm">2</button>
                            <button class="btn btn-secondary btn-sm">3</button>
                            <button class="btn btn-secondary btn-sm" onclick="nextPage()">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reports Section -->
    <section id="reports-section" style="display: none;">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <!-- Quick Reports Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div class="card" onclick="generateQuickReport('daily')" style="cursor: pointer;">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="color: var(--primary-color); margin-bottom: 1rem;">
                            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                        </svg>
                        <h3>Daily Sales Report</h3>
                        <p>Today's sales performance</p>
                    </div>
                </div>

                <div class="card" onclick="generateQuickReport('inventory')" style="cursor: pointer;">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="color: var(--secondary-color); margin-bottom: 1rem;">
                            <path d="M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zM19 20H5V9h14v11z"/>
                        </svg>
                        <h3>Inventory Report</h3>
                        <p>Stock levels and valuation</p>
                    </div>
                </div>

                <div class="card" onclick="generateQuickReport('expiry')" style="cursor: pointer;">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="color: var(--warning-color); margin-bottom: 1rem;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <h3>Expiry Report</h3>
                        <p>Products nearing expiry</p>
                    </div>
                </div>

                <div class="card" onclick="generateQuickReport('financial')" style="cursor: pointer;">
                    <div class="card-content" style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="color: var(--info-color); margin-bottom: 1rem;">
                            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                        </svg>
                        <h3>Financial Report</h3>
                        <p>Revenue and profit analysis</p>
                    </div>
                </div>
            </div>

            <!-- Custom Report Builder -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Custom Report Builder</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <select id="report-type" class="search-input" style="max-width: 200px;">
                            <option value="sales">Sales Analysis</option>
                            <option value="inventory">Inventory Analysis</option>
                            <option value="expiry">Expiry Analysis</option>
                            <option value="customer">Customer Analysis</option>
                            <option value="financial">Financial Analysis</option>
                            <option value="performance">Performance Analysis</option>
                        </select>
                        <input type="date" id="report-date-from" class="search-input" style="max-width: 150px;">
                        <input type="date" id="report-date-to" class="search-input" style="max-width: 150px;">
                        <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                        <button class="btn btn-secondary" onclick="exportReport()">Export PDF</button>
                        <button class="btn btn-secondary" onclick="scheduleReport()">Schedule</button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="report-content">
                        <div style="text-align: center; color: #64748b; padding: 3rem;">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor" style="margin-bottom: 1rem; opacity: 0.5;">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                            <h3>Generate Custom Reports</h3>
                            <p>Select report type, date range, and click "Generate Report" to view detailed analytics</p>
                            <div style="margin-top: 2rem;">
                                <h4>Available Report Types:</h4>
                                <ul style="text-align: left; display: inline-block; margin-top: 1rem;">
                                    <li><strong>Sales Analysis:</strong> Revenue, transactions, trends</li>
                                    <li><strong>Inventory Analysis:</strong> Stock levels, turnover, valuation</li>
                                    <li><strong>Expiry Analysis:</strong> Products nearing expiry, waste analysis</li>
                                    <li><strong>Customer Analysis:</strong> Purchase patterns, loyalty metrics</li>
                                    <li><strong>Financial Analysis:</strong> Profit margins, cost analysis</li>
                                    <li><strong>Performance Analysis:</strong> KPIs, benchmarks, growth metrics</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scheduled Reports -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h3 class="card-title">Scheduled Reports</h3>
                    <button class="btn btn-primary" onclick="showScheduleModal()">Add Schedule</button>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Report Name</th>
                                    <th>Type</th>
                                    <th>Frequency</th>
                                    <th>Next Run</th>
                                    <th>Recipients</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Daily Sales Summary</td>
                                    <td>Sales</td>
                                    <td>Daily</td>
                                    <td>Tomorrow 9:00 AM</td>
                                    <td>manager@pharmacy.com</td>
                                    <td><span class="status active">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-secondary">Edit</button>
                                        <button class="btn btn-sm btn-danger">Delete</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Weekly Inventory Report</td>
                                    <td>Inventory</td>
                                    <td>Weekly</td>
                                    <td>Monday 8:00 AM</td>
                                    <td>inventory@pharmacy.com</td>
                                    <td><span class="status active">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-secondary">Edit</button>
                                        <button class="btn btn-sm btn-danger">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Settings Section -->
    <section id="settings-section" style="display: none;">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">System Settings</h2>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                        <!-- Pharmacy Settings -->
                        <div class="settings-group">
                            <h3>Pharmacy Information</h3>
                            <div class="form-group">
                                <label>Pharmacy Name</label>
                                <input type="text" id="pharmacy-name" class="form-control" value="Pathway Pharmacy">
                            </div>
                            <div class="form-group">
                                <label>Address</label>
                                <textarea id="pharmacy-address" class="form-control">123 Main St, Accra, Ghana</textarea>
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="text" id="pharmacy-phone" class="form-control" value="+233 20 123 4567">
                            </div>
                            <div class="form-group">
                                <label>License Number</label>
                                <input type="text" id="pharmacy-license" class="form-control" value="PH123456789">
                            </div>
                        </div>

                        <!-- Tax & Currency Settings -->
                        <div class="settings-group">
                            <h3>Tax & Currency</h3>
                            <div class="form-group">
                                <label>Currency</label>
                                <select id="currency" class="form-control">
                                    <option value="GHS" selected>Ghana Cedis (₵)</option>
                                    <option value="USD">US Dollar ($)</option>
                                    <option value="EUR">Euro (€)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tax Rate (%)</label>
                                <input type="number" id="tax-rate" class="form-control" value="12.5" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Receipt Footer</label>
                                <textarea id="receipt-footer" class="form-control">Thank you for choosing Pathway Pharmacy!</textarea>
                            </div>
                        </div>

                        <!-- Expiry Alert Settings -->
                        <div class="settings-group">
                            <h3>Expiry Alert Thresholds</h3>
                            <div class="form-group">
                                <label>Critical Alert (days)</label>
                                <input type="number" id="alert-critical" class="form-control" value="7">
                            </div>
                            <div class="form-group">
                                <label>High Alert (days)</label>
                                <input type="number" id="alert-high" class="form-control" value="30">
                            </div>
                            <div class="form-group">
                                <label>Medium Alert (days)</label>
                                <input type="number" id="alert-medium" class="form-control" value="90">
                            </div>
                            <div class="form-group">
                                <label>Low Alert (days)</label>
                                <input type="number" id="alert-low" class="form-control" value="180">
                            </div>
                        </div>

                        <!-- System Settings -->
                        <div class="settings-group">
                            <h3>System Preferences</h3>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="auto-print-receipt" checked>
                                    Auto-print receipts
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="low-stock-alerts" checked>
                                    Enable low stock alerts
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="expiry-notifications" checked>
                                    Enable expiry notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Default Payment Method</label>
                                <select id="default-payment" class="form-control">
                                    <option value="cash">Cash</option>
                                    <option value="mobile_money">Mobile Money</option>
                                    <option value="card">Card</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; text-align: center;">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                        <button class="btn btn-secondary" onclick="resetSettings()">Reset to Defaults</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Templates (Hidden by default) -->

    <!-- Add Product Modal -->
    <div id="add-product-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Add New Product</h3>
                <button class="close-btn" onclick="closeModal('add-product-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="new-product-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Generic Name</label>
                        <input type="text" id="new-product-generic" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Brand Name</label>
                        <input type="text" id="new-product-brand" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>SKU *</label>
                        <input type="text" id="new-product-sku" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Barcode</label>
                        <input type="text" id="new-product-barcode" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="new-product-category" class="form-control">
                            <option value="">Select Category</option>
                            <option value="1">Pain Relief</option>
                            <option value="2">Antibiotics</option>
                            <option value="3">Vitamins</option>
                            <option value="4">Cold & Flu</option>
                            <option value="5">Diabetes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dosage Form</label>
                        <input type="text" id="new-product-dosage" class="form-control" placeholder="e.g., Tablet, Capsule">
                    </div>
                    <div class="form-group">
                        <label>Strength</label>
                        <input type="text" id="new-product-strength" class="form-control" placeholder="e.g., 500mg">
                    </div>
                    <div class="form-group">
                        <label>Cost Price (₵) *</label>
                        <input type="number" id="new-product-cost" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Selling Price (₵) *</label>
                        <input type="number" id="new-product-price" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Minimum Stock Level</label>
                        <input type="number" id="new-product-min-stock" class="form-control" value="10">
                    </div>
                    <div class="form-group">
                        <label>Reorder Point</label>
                        <input type="number" id="new-product-reorder" class="form-control" value="5">
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="new-product-prescription">
                        Requires Prescription
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="new-product-controlled">
                        Controlled Substance
                    </label>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="new-product-description" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-product-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewProduct()">Save Product</button>
            </div>
        </div>
    </div>

    <!-- Add Stock Batch Modal -->
    <div id="add-batch-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Stock Batch</h3>
                <button class="close-btn" onclick="closeModal('add-batch-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Product *</label>
                    <select id="batch-product" class="form-control" required>
                        <option value="">Select Product</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Batch Number *</label>
                        <input type="text" id="batch-number" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Lot Number</label>
                        <input type="text" id="batch-lot" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Quantity *</label>
                        <input type="number" id="batch-quantity" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Cost per Unit (₵) *</label>
                        <input type="number" id="batch-cost" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Selling Price per Unit (₵) *</label>
                        <input type="number" id="batch-price" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Expiry Date *</label>
                        <input type="date" id="batch-expiry" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Manufacture Date</label>
                        <input type="date" id="batch-manufacture" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Supplier</label>
                        <input type="text" id="batch-supplier" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="batch-notes" class="form-control" rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-batch-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewBatch()">Add Stock</button>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div id="customer-details-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Customer Details</h3>
                <button class="close-btn" onclick="closeModal('customer-details-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" id="customer-first-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" id="customer-last-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="customer-email" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Phone *</label>
                        <input type="tel" id="customer-phone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="customer-dob" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="customer-gender" class="form-control">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="customer-address" class="form-control" placeholder="Street Address">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="customer-city" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Region</label>
                        <select id="customer-region" class="form-control">
                            <option value="">Select Region</option>
                            <option value="Greater Accra">Greater Accra</option>
                            <option value="Ashanti">Ashanti</option>
                            <option value="Western">Western</option>
                            <option value="Central">Central</option>
                            <option value="Eastern">Eastern</option>
                            <option value="Northern">Northern</option>
                            <option value="Upper East">Upper East</option>
                            <option value="Upper West">Upper West</option>
                            <option value="Volta">Volta</option>
                            <option value="Brong Ahafo">Brong Ahafo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Postal Code</label>
                        <input type="text" id="customer-postal" class="form-control">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Emergency Contact Name</label>
                        <input type="text" id="customer-emergency-name" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact Phone</label>
                        <input type="tel" id="customer-emergency-phone" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>Medical Allergies</label>
                    <textarea id="customer-allergies" class="form-control" rows="2" placeholder="List any known allergies"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="customer-marketing">
                        Marketing Consent
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="customer-reminders" checked>
                        Prescription Reminders
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('customer-details-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveCustomerDetails()">Save Customer</button>
            </div>
        </div>
    </div>

    <!-- Sale Details Modal -->
    <div id="sale-details-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Sale Details</h3>
                <button class="close-btn" onclick="closeModal('sale-details-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="sale-details-content">
                    <!-- Sale details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sale-details-modal')">Close</button>
                <button class="btn btn-primary" onclick="printSaleReceipt()">Print Receipt</button>
                <button class="btn btn-danger" onclick="refundSale()">Process Refund</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/pos.js"></script>
    <script src="/static/js/receipt.js"></script>
    <script src="/static/js/receipt.js"></script>
    
    <!-- Navigation Script -->
    <script>
        // Simple navigation between sections
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-menu a');
            const sections = {
                'dashboard': document.getElementById('dashboard-section'),
                'pos': document.getElementById('pos-section'),
                'inventory': document.getElementById('inventory-section'),
                'expiry': document.getElementById('expiry-dashboard'),
                'customers': document.getElementById('customers-section'),
                'sales': document.getElementById('sales-section'),
                'reports': document.getElementById('reports-section'),
                'settings': document.getElementById('settings-section')
            };

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Hide all sections
                    Object.values(sections).forEach(section => {
                        if (section) section.style.display = 'none';
                    });
                    
                    // Show selected section
                    const sectionName = this.getAttribute('href').substring(1);
                    if (sections[sectionName]) {
                        sections[sectionName].style.display = 'block';
                    } else {
                        // Show POS section by default
                        if (sections.pos) sections.pos.style.display = 'block';
                    }

                    // Handle cart visibility - only show in POS section
                    const mainContainer = document.querySelector('.main-container');
                    if (sectionName === 'pos') {
                        mainContainer.classList.add('pos-layout');
                    } else {
                        mainContainer.classList.remove('pos-layout');
                    }

                    // Load data based on section
                    if (sectionName === 'expiry') {
                        loadExpiryDashboard();
                    } else if (sectionName === 'inventory') {
                        loadInventoryData();
                    } else if (sectionName === 'customers') {
                        loadCustomersData();
                    } else if (sectionName === 'sales') {
                        loadSalesData();
                    }
                });
            });

            // Load expiry dashboard data
            async function loadExpiryDashboard() {
                try {
                    const response = await fetch('/api/expiry/dashboard');
                    const data = await response.json();
                    
                    // Update stats
                    document.getElementById('critical-count').textContent = data.alert_counts.critical;
                    document.getElementById('high-count').textContent = data.alert_counts.high;
                    document.getElementById('medium-count').textContent = data.alert_counts.medium;
                    document.getElementById('total-value').textContent = `$${data.summary.total_value.toLocaleString()}`;
                    
                    // Update critical alerts table
                    const tableBody = document.getElementById('critical-alerts-table');
                    if (data.critical_alerts.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #10b981;">No critical alerts</td></tr>';
                    } else {
                        tableBody.innerHTML = data.critical_alerts.map(alert => `
                            <tr>
                                <td>${alert.product_name}</td>
                                <td>${alert.batch_number}</td>
                                <td>${alert.current_quantity}</td>
                                <td>${alert.expiry_date}</td>
                                <td class="text-danger">${alert.days_until_expiry} days</td>
                                <td>$${alert.estimated_value.toFixed(2)}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="markExpired(${alert.batch_id})">
                                        Mark Expired
                                    </button>
                                </td>
                            </tr>
                        `).join('');
                    }
                } catch (error) {
                    console.error('Error loading expiry dashboard:', error);
                }
            }

            // Mark batch as expired
            window.markExpired = async function(batchId) {
                if (confirm('Are you sure you want to mark this batch as expired?')) {
                    try {
                        const response = await fetch(`/api/expiry/batches/${batchId}/mark-expired?user_id=1`, {
                            method: 'POST'
                        });
                        
                        if (response.ok) {
                            alert('Batch marked as expired successfully');
                            loadExpiryDashboard(); // Reload data
                        } else {
                            alert('Error marking batch as expired');
                        }
                    } catch (error) {
                        console.error('Error marking batch as expired:', error);
                        alert('Error marking batch as expired');
                    }
                }
            };

            // Load inventory data
            async function loadInventoryData() {
                try {
                    const response = await fetch('/api/products');
                    const products = await response.json();

                    // Update stats
                    document.getElementById('total-products').textContent = products.length;
                    document.getElementById('low-stock-count').textContent = products.filter(p => p.min_stock_level <= 10).length;
                    document.getElementById('inventory-value').textContent = `₵${products.reduce((sum, p) => sum + (p.selling_price * p.min_stock_level), 0).toFixed(2)}`;
                    document.getElementById('categories-count').textContent = new Set(products.map(p => p.category_id)).size;

                    const tableBody = document.getElementById('inventory-table');
                    if (tableBody) {
                        tableBody.innerHTML = products.map(product => `
                            <tr>
                                <td>
                                    <div style="font-weight: bold;">${product.name}</div>
                                    <div style="font-size: 0.875rem; color: #64748b;">${product.generic_name || ''}</div>
                                </td>
                                <td>${product.sku}</td>
                                <td>${getCategoryName(product.category_id)}</td>
                                <td>
                                    <span class="stock-level ${getStockLevelClass(product.min_stock_level)}">
                                        ${product.min_stock_level} units
                                    </span>
                                </td>
                                <td>${product.reorder_point}</td>
                                <td>₵${product.cost_price}</td>
                                <td>₵${product.selling_price}</td>
                                <td>
                                    <span class="status ${product.is_active ? 'active' : 'inactive'}">
                                        ${product.is_active ? 'Active' : 'Inactive'}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="editProduct(${product.id})">Edit</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('');
                    }
                } catch (error) {
                    console.error('Error loading inventory:', error);
                    const tableBody = document.getElementById('inventory-table');
                    if (tableBody) {
                        tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #ef4444;">Error loading inventory data</td></tr>';
                    }
                }
            }

            // Load customers data
            async function loadCustomersData() {
                try {
                    // Simulate customer data since we don't have the API endpoint yet
                    const customers = [
                        {
                            id: 'LC001',
                            first_name: 'Akosua',
                            last_name: 'Mensah',
                            email: 'akosua.mensah@gmail.com',
                            phone: '+233 24 111 2222',
                            address: '123 Liberation Road, Accra',
                            loyalty_points: 150,
                            total_spent: 1850.75,
                            last_visit: '2025-07-25'
                        },
                        {
                            id: 'LC002',
                            first_name: 'Kwame',
                            last_name: 'Asante',
                            email: 'kwame.asante@yahoo.com',
                            phone: '+233 20 333 4444',
                            address: '456 Osu Oxford Street, Accra',
                            loyalty_points: 75,
                            total_spent: 950.50,
                            last_visit: '2025-07-20'
                        },
                        {
                            id: 'LC003',
                            first_name: 'Ama',
                            last_name: 'Osei',
                            email: 'ama.osei@hotmail.com',
                            phone: '+233 26 555 6666',
                            address: '789 Spintex Road, Accra',
                            loyalty_points: 200,
                            total_spent: 2450.25,
                            last_visit: '2025-07-28'
                        }
                    ];

                    // Update customer stats
                    document.getElementById('total-customers').textContent = customers.length;
                    document.getElementById('active-customers').textContent = customers.filter(c => new Date(c.last_visit) > new Date(Date.now() - 30*24*60*60*1000)).length;
                    document.getElementById('loyalty-members').textContent = customers.filter(c => c.loyalty_points > 0).length;
                    document.getElementById('avg-spent').textContent = `₵${(customers.reduce((sum, c) => sum + c.total_spent, 0) / customers.length).toFixed(2)}`;

                    const tableBody = document.getElementById('customers-table');
                    if (tableBody) {
                        tableBody.innerHTML = customers.map(customer => `
                            <tr>
                                <td>${customer.id}</td>
                                <td>${customer.first_name} ${customer.last_name}</td>
                                <td>${customer.email}</td>
                                <td>${customer.phone}</td>
                                <td>${customer.address}</td>
                                <td>
                                    <span style="background: #dcfce7; color: #166534; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">
                                        ${customer.loyalty_points} pts
                                    </span>
                                </td>
                                <td>₵${customer.total_spent.toFixed(2)}</td>
                                <td>${customer.last_visit}</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="editCustomer('${customer.id}')">Edit</button>
                                    <button class="btn btn-sm btn-primary" onclick="viewCustomerHistory('${customer.id}')">History</button>
                                </td>
                            </tr>
                        `).join('');
                    }
                } catch (error) {
                    console.error('Error loading customers:', error);
                    const tableBody = document.getElementById('customers-table');
                    if (tableBody) {
                        tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #ef4444;">Error loading customer data</td></tr>';
                    }
                }
            }

            // Load sales data
            async function loadSalesData() {
                try {
                    // Simulate sales data
                    const sales = [
                        {
                            id: 'POS20250728001',
                            date: '2025-07-28',
                            time: '09:15:30',
                            customer: 'Akosua Mensah',
                            items: 3,
                            subtotal: 125.50,
                            vat: 15.69,
                            total: 141.19,
                            payment_method: 'Mobile Money',
                            cashier: 'Dr. Jane Smith',
                            status: 'Completed'
                        },
                        {
                            id: 'POS20250728002',
                            date: '2025-07-28',
                            time: '10:30:45',
                            customer: 'Walk-in Customer',
                            items: 1,
                            subtotal: 45.00,
                            vat: 5.63,
                            total: 50.63,
                            payment_method: 'Cash',
                            cashier: 'John Doe',
                            status: 'Completed'
                        },
                        {
                            id: 'POS20250728003',
                            date: '2025-07-28',
                            time: '11:45:20',
                            customer: 'Kwame Asante',
                            items: 2,
                            subtotal: 89.75,
                            vat: 11.22,
                            total: 100.97,
                            payment_method: 'Card',
                            cashier: 'Dr. Jane Smith',
                            status: 'Completed'
                        }
                    ];

                    // Update stats
                    const todayTotal = sales.reduce((sum, sale) => sum + sale.total, 0);
                    document.getElementById('today-sales').textContent = `₵${todayTotal.toFixed(2)}`;
                    document.getElementById('today-change').textContent = '+12.5%';
                    document.getElementById('week-sales').textContent = '₵1,250.75';
                    document.getElementById('week-change').textContent = '+8.3%';
                    document.getElementById('month-sales').textContent = '₵8,450.25';
                    document.getElementById('month-change').textContent = '+15.2%';
                    document.getElementById('total-transactions').textContent = sales.length.toString();
                    document.getElementById('transactions-change').textContent = `+${sales.length}`;

                    const tableBody = document.getElementById('sales-table');
                    if (tableBody) {
                        tableBody.innerHTML = sales.map(sale => `
                            <tr>
                                <td><strong>${sale.id}</strong></td>
                                <td>
                                    <div>${sale.date}</div>
                                    <div style="font-size: 0.875rem; color: #64748b;">${sale.time}</div>
                                </td>
                                <td>${sale.customer}</td>
                                <td>${sale.items}</td>
                                <td>₵${sale.subtotal.toFixed(2)}</td>
                                <td>₵${sale.vat.toFixed(2)}</td>
                                <td><strong>₵${sale.total.toFixed(2)}</strong></td>
                                <td>
                                    <span class="payment-badge ${sale.payment_method.toLowerCase().replace(' ', '-')}">
                                        ${sale.payment_method}
                                    </span>
                                </td>
                                <td>${sale.cashier}</td>
                                <td>
                                    <span class="status ${sale.status.toLowerCase()}">
                                        ${sale.status}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewSaleDetails('${sale.id}')">View</button>
                                    <button class="btn btn-sm btn-primary" onclick="printReceipt('${sale.id}')">Print</button>
                                </td>
                            </tr>
                        `).join('');
                    }
                } catch (error) {
                    console.error('Error loading sales:', error);
                    const tableBody = document.getElementById('sales-table');
                    if (tableBody) {
                        tableBody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #ef4444;">Error loading sales data</td></tr>';
                    }
                }
            }

            // Utility functions
            function getStockLevelClass(stock) {
                if (stock <= 10) return 'low';
                if (stock <= 25) return 'medium';
                return 'high';
            }

            function getCategoryName(categoryId) {
                const categories = {
                    1: 'Pain Relief',
                    2: 'Antibiotics',
                    3: 'Vitamins',
                    4: 'Cold & Flu',
                    5: 'Diabetes',
                    6: 'Heart Health',
                    7: 'OTC'
                };
                return categories[categoryId] || 'Uncategorized';
            }

            function formatCurrency(amount) {
                return `₵${parseFloat(amount).toFixed(2)}`;
            }

            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            }

            // Modal functions
            window.showAddProductModal = function() {
                const modal = document.getElementById('add-product-modal');
                if (modal) {
                    modal.style.display = 'flex';
                } else {
                    alert('Add Product functionality - modal not found');
                }
            };

            window.showAddBatchModal = function() {
                alert('Add Stock Batch functionality - to be implemented');
            };

            window.showAddCustomerModal = function() {
                const modal = document.getElementById('customer-details-modal');
                if (modal) {
                    modal.style.display = 'flex';
                } else {
                    alert('Add Customer functionality - modal not found');
                }
            };

            // Product management functions
            window.editProduct = function(productId) {
                alert(`Edit product ${productId} - to be implemented`);
            };

            window.deleteProduct = function(productId) {
                if (confirm('Are you sure you want to delete this product?')) {
                    alert(`Delete product ${productId} - to be implemented`);
                }
            };

            // Customer management functions
            window.editCustomer = function(customerId) {
                alert(`Edit customer ${customerId} - to be implemented`);
            };

            window.viewCustomerHistory = function(customerId) {
                alert(`View customer ${customerId} history - to be implemented`);
            };

            // Sales functions
            window.viewSaleDetails = function(saleId) {
                alert(`View sale ${saleId} details - to be implemented`);
            };

            window.printReceipt = function(saleId) {
                alert(`Print receipt for sale ${saleId} - to be implemented`);
            };

            // Export functions
            window.exportInventory = function() {
                alert('Export inventory - to be implemented');
            };

            window.exportCustomers = function() {
                alert('Export customers - to be implemented');
            };

            window.exportSales = function() {
                alert('Export sales - to be implemented');
            };

            window.importCustomers = function() {
                alert('Import customers - to be implemented');
            };

            // Filter functions
            window.filterInventory = function() {
                const search = document.getElementById('inventory-search').value;
                const category = document.getElementById('category-filter').value;
                const stock = document.getElementById('stock-filter').value;
                alert(`Filter inventory: search="${search}", category="${category}", stock="${stock}"`);
            };

            window.filterCustomers = function() {
                const search = document.getElementById('customer-search').value;
                const type = document.getElementById('customer-type-filter').value;
                alert(`Filter customers: search="${search}", type="${type}"`);
            };

            // Pagination functions
            window.previousPage = function() {
                alert('Previous page - to be implemented');
            };

            window.nextPage = function() {
                alert('Next page - to be implemented');
            };

            window.holdTransaction = function() {
                if (window.pos) {
                    window.pos.holdTransaction();
                }
            };

            window.showCustomerModal = function() {
                if (window.pos) {
                    window.pos.showCustomerModal();
                }
            };

            window.showDiscountModal = function() {
                if (window.pos) {
                    window.pos.showDiscountModal();
                }
            };

            // Settings functions
            window.saveSettings = function() {
                alert('Settings saved successfully!');
            };

            window.resetSettings = function() {
                if (confirm('Are you sure you want to reset all settings to defaults?')) {
                    alert('Settings reset to defaults');
                }
            };

            // Report functions
            window.generateReport = function() {
                const reportType = document.getElementById('report-type').value;
                const dateFrom = document.getElementById('report-date-from').value;
                const dateTo = document.getElementById('report-date-to').value;
                const reportContent = document.getElementById('report-content');

                const reportData = generateSampleReportData(reportType);

                reportContent.innerHTML = `
                    <div style="padding: 2rem;">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <h3>${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report</h3>
                            <p>Generated on ${new Date().toLocaleDateString('en-GB')}</p>
                            ${dateFrom && dateTo ? `<p>Period: ${dateFrom} to ${dateTo}</p>` : ''}
                        </div>
                        ${reportData}
                    </div>
                `;
            };

            window.generateQuickReport = function(type) {
                const reportContent = document.getElementById('report-content');
                const reportData = generateSampleReportData(type);

                reportContent.innerHTML = `
                    <div style="padding: 2rem;">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <h3>${type.charAt(0).toUpperCase() + type.slice(1)} Report</h3>
                            <p>Generated on ${new Date().toLocaleDateString('en-GB')}</p>
                        </div>
                        ${reportData}
                    </div>
                `;
            };

            function generateSampleReportData(type) {
                switch(type) {
                    case 'sales':
                    case 'daily':
                        return `
                            <div class="expiry-grid" style="margin-bottom: 2rem;">
                                <div class="stat-card stat-success">
                                    <div class="stat-value">₵292.79</div>
                                    <div class="stat-label">Today's Revenue</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">3</div>
                                    <div class="stat-label">Transactions</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">₵97.60</div>
                                    <div class="stat-label">Average Sale</div>
                                </div>
                                <div class="stat-card stat-warning">
                                    <div class="stat-value">6</div>
                                    <div class="stat-label">Items Sold</div>
                                </div>
                            </div>
                            <h4>Top Selling Products Today</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Product</th><th>Quantity</th><th>Revenue</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Ibuprofen 200mg</td><td>2</td><td>₵71.98</td></tr>
                                    <tr><td>Vitamin D3 1000 IU</td><td>2</td><td>₵103.98</td></tr>
                                    <tr><td>Acetaminophen 500mg</td><td>2</td><td>₵59.98</td></tr>
                                </tbody>
                            </table>
                        `;
                    case 'inventory':
                        return `
                            <div class="expiry-grid" style="margin-bottom: 2rem;">
                                <div class="stat-card">
                                    <div class="stat-value">8</div>
                                    <div class="stat-label">Total Products</div>
                                </div>
                                <div class="stat-card stat-warning">
                                    <div class="stat-value">2</div>
                                    <div class="stat-label">Low Stock</div>
                                </div>
                                <div class="stat-card stat-success">
                                    <div class="stat-value">₵15,420</div>
                                    <div class="stat-label">Total Value</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">5</div>
                                    <div class="stat-label">Categories</div>
                                </div>
                            </div>
                            <h4>Stock Levels by Category</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Category</th><th>Products</th><th>Total Stock</th><th>Value</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Pain Relief</td><td>2</td><td>150</td><td>₵4,200</td></tr>
                                    <tr><td>Antibiotics</td><td>2</td><td>80</td><td>₵6,800</td></tr>
                                    <tr><td>Vitamins</td><td>2</td><td>120</td><td>₵3,200</td></tr>
                                    <tr><td>Others</td><td>2</td><td>90</td><td>₵1,220</td></tr>
                                </tbody>
                            </table>
                        `;
                    case 'expiry':
                        return `
                            <div class="expiry-grid" style="margin-bottom: 2rem;">
                                <div class="stat-card stat-critical">
                                    <div class="stat-value">2</div>
                                    <div class="stat-label">Critical (≤1 week)</div>
                                </div>
                                <div class="stat-card stat-warning">
                                    <div class="stat-value">3</div>
                                    <div class="stat-label">High (≤1 month)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">5</div>
                                    <div class="stat-label">Medium (≤3 months)</div>
                                </div>
                                <div class="stat-card stat-success">
                                    <div class="stat-value">₵2,450</div>
                                    <div class="stat-label">At Risk Value</div>
                                </div>
                            </div>
                            <h4>Products Expiring Soon</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Product</th><th>Batch</th><th>Expiry Date</th><th>Days Left</th><th>Quantity</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Ibuprofen 200mg</td><td>BATCH001</td><td>2025-08-05</td><td>8</td><td>30</td></tr>
                                    <tr><td>Vitamin D3</td><td>BATCH002</td><td>2025-08-15</td><td>18</td><td>75</td></tr>
                                </tbody>
                            </table>
                        `;
                    case 'financial':
                        return `
                            <div class="expiry-grid" style="margin-bottom: 2rem;">
                                <div class="stat-card stat-success">
                                    <div class="stat-value">₵8,450</div>
                                    <div class="stat-label">Monthly Revenue</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">₵5,200</div>
                                    <div class="stat-label">Cost of Goods</div>
                                </div>
                                <div class="stat-card stat-warning">
                                    <div class="stat-value">₵3,250</div>
                                    <div class="stat-label">Gross Profit</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">38.5%</div>
                                    <div class="stat-label">Profit Margin</div>
                                </div>
                            </div>
                            <h4>Revenue Breakdown</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Category</th><th>Revenue</th><th>Cost</th><th>Profit</th><th>Margin</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Prescription</td><td>₵5,200</td><td>₵3,100</td><td>₵2,100</td><td>40.4%</td></tr>
                                    <tr><td>OTC</td><td>₵2,450</td><td>₵1,500</td><td>₵950</td><td>38.8%</td></tr>
                                    <tr><td>Vitamins</td><td>₵800</td><td>₵600</td><td>₵200</td><td>25.0%</td></tr>
                                </tbody>
                            </table>
                        `;
                    default:
                        return `
                            <div style="text-align: center; padding: 2rem;">
                                <p>Sample ${type} report data would be displayed here.</p>
                                <p>This is a demonstration of the reporting functionality.</p>
                            </div>
                        `;
                }
            }

            window.exportReport = function() {
                alert('Report export functionality - to be implemented');
            };

            window.scheduleReport = function() {
                alert('Schedule report functionality - to be implemented');
            };

            window.showScheduleModal = function() {
                alert('Schedule modal - to be implemented');
            };

            window.filterSales = function() {
                const dateFrom = document.getElementById('sales-date-from').value;
                const dateTo = document.getElementById('sales-date-to').value;
                const paymentMethod = document.getElementById('payment-method-filter').value;
                showNotification(`Filtering sales: ${dateFrom} to ${dateTo}, payment: ${paymentMethod}`, 'info');
            };

            // Enhanced Feature Functions
            window.refreshProducts = function() {
                showNotification('Refreshing product list...', 'info');
                loadPOSData();
            };

            window.showCustomerSegments = function() {
                showNotification('Customer segmentation analysis - coming soon!', 'info');
            };

            window.showLoyaltyProgram = function() {
                showNotification('Loyalty program management - coming soon!', 'info');
            };

            window.showCustomerAnalytics = function() {
                showNotification('Customer analytics dashboard - coming soon!', 'info');
            };

            // Notification System
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease forwards';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // Enhanced Data Loading with Animation
            function showLoadingState(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <div style="width: 40px; height: 40px; border: 3px solid var(--light-gray); border-top: 3px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                            <p style="color: var(--dark-gray);">Loading...</p>
                        </div>
                    `;
                }
            }

            // Enhanced Error Handling
            function showErrorState(elementId, message) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--danger-color);">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="margin-bottom: 1rem;">
                                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                            </svg>
                            <h3>Error Loading Data</h3>
                            <p>${message}</p>
                            <button class="btn btn-primary" onclick="location.reload()">Retry</button>
                        </div>
                    `;
                }
            }

            // Save functions
            window.saveNewProduct = function() {
                const name = document.getElementById('new-product-name').value;
                const sku = document.getElementById('new-product-sku').value;
                const cost = document.getElementById('new-product-cost').value;
                const price = document.getElementById('new-product-price').value;

                if (!name || !sku || !cost || !price) {
                    alert('Please fill in all required fields');
                    return;
                }

                alert(`Product saved: ${name} (${sku}) - Cost: ₵${cost}, Price: ₵${price}`);
                closeModal('add-product-modal');
                loadInventoryData(); // Refresh the inventory
            };

            window.saveCustomerDetails = function() {
                const firstName = document.getElementById('customer-first-name').value;
                const lastName = document.getElementById('customer-last-name').value;
                const phone = document.getElementById('customer-phone').value;
                const email = document.getElementById('customer-email').value;

                if (!firstName || !lastName || !phone) {
                    alert('Please fill in all required fields');
                    return;
                }

                alert(`Customer saved: ${firstName} ${lastName} - Phone: ${phone}, Email: ${email}`);
                closeModal('customer-details-modal');
                loadCustomersData(); // Refresh the customers
            };

            // Initialize the page - show Dashboard section by default
            const dashboardSection = document.getElementById('dashboard-section');
            if (dashboardSection) {
                dashboardSection.style.display = 'block';
            }

            // Set first nav item as active
            const firstNavItem = document.querySelector('a[href="#dashboard"]');
            if (firstNavItem) {
                firstNavItem.classList.add('active');
            }

            // Update time and date
            function updateDateTime() {
                const now = new Date();
                const timeElement = document.getElementById('current-time');
                const dateElement = document.getElementById('current-date');

                if (timeElement) {
                    timeElement.textContent = now.toLocaleTimeString('en-GB', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }

                if (dateElement) {
                    dateElement.textContent = now.toLocaleDateString('en-GB', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }
            }

            // Update time immediately and then every minute
            updateDateTime();
            setInterval(updateDateTime, 60000);

            // Enhanced showSection function
            window.showSection = function(sectionId) {
                // Hide all sections
                Object.values(sections).forEach(section => {
                    if (section) section.style.display = 'none';
                });

                // Remove active class from all nav items
                document.querySelectorAll('.nav-menu a').forEach(item => {
                    item.classList.remove('active');
                });

                // Show selected section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                }

                // Add active class to corresponding nav item
                const navItem = document.querySelector(`a[href="#${sectionId.replace('-section', '')}"]`);
                if (navItem) {
                    navItem.classList.add('active');
                }

                // Handle cart visibility - only show in POS section
                const mainContainer = document.querySelector('.main-container');
                if (sectionId === 'pos-section') {
                    mainContainer.classList.add('pos-layout');
                } else {
                    mainContainer.classList.remove('pos-layout');
                }

                // Load section-specific data
                switch(sectionId) {
                    case 'dashboard-section':
                        updateDateTime();
                        break;
                    case 'pos-section':
                        loadPOSData();
                        break;
                    case 'inventory-section':
                        loadInventoryData();
                        break;
                    case 'expiry-dashboard':
                        loadExpiryDashboard();
                        break;
                    case 'customers-section':
                        loadCustomersData();
                        break;
                    case 'sales-section':
                        loadSalesData();
                        break;
                }
            };

            // Load initial data
            loadExpiryDashboard();
        });
    </script>

    <!-- Modal Templates -->
    <div id="add-product-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Add New Product</h3>
                <button class="close-btn" onclick="closeModal('add-product-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="new-product-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>SKU *</label>
                        <input type="text" id="new-product-sku" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Cost Price (₵) *</label>
                        <input type="number" id="new-product-cost" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Selling Price (₵) *</label>
                        <input type="number" id="new-product-price" class="form-control" step="0.01" required>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-product-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewProduct()">Save Product</button>
            </div>
        </div>
    </div>

    <div id="customer-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Customer Details</h3>
                <button class="close-btn" onclick="closeModal('customer-details-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" id="customer-first-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" id="customer-last-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Phone *</label>
                        <input type="tel" id="customer-phone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="customer-email" class="form-control">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('customer-details-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveCustomerDetails()">Save Customer</button>
            </div>
        </div>
    </div>
</body>
</html>
